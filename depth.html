<!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. --><!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assigning Bathymetry &mdash; schimpy 1.8.0+16.g1516eaa.dirty documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=6cf38a39"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SCHISM hotstart" href="hotstart.html" />
    <link rel="prev" title="Model time conversion" href="model_time.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/dwr_logo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial.html">Spatial data in SCHISM</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Pre-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="sms.html">Working with SMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_time.html">Model time</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Populating Elevation/Depth Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#named-arguments">Named Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#assigning-depths-from-prioritized-dems">Assigning depths from prioritized DEMs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stacked-dem-fill">stacked_dem_fill</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#positional-arguments">Positional Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#named-arguments">Named Arguments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#smoother-for-complex-topography">Smoother for complex topography</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#subcommands">subcommands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Sub-commands">Sub-commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#smooth">smooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="#view">view</a></li>
<li class="toctree-l4"><a class="reference internal" href="#save">save</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#optimizing-depths-for-volume">Optimizing depths for volume</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#positional-arguments">Positional Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#named-arguments">Named Arguments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hotstart.html">Creating hotstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="nudging.html">Creating nudging</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">Post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Evaluating Model Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="direct_use.html">Using Python Pre-processing Script Programatically</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="license_and_disclaimer.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme.html">Project README</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">schimpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="assigning-bathymetry">
<h1>Assigning Bathymetry<a class="headerlink" href="#assigning-bathymetry" title="Link to this heading"></a></h1>
<p>Converting a 2dm file to gr3 or between gr3 or 2dm and shapefile</p>
<p><p>Convert a mesh from one format to another. The format is decided by the extensions automatically.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">convert_mesh</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">input</span> <span class="n">INPUT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">output</span> <span class="n">OUTPUT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">crs</span> <span class="n">CRS</span><span class="p">]</span>
</pre></div>
</div>
<section id="named-arguments">
<h2>Named Arguments<a class="headerlink" href="#named-arguments" title="Link to this heading"></a></h2>
<dl class="option-list">
<dt><kbd>--input</kbd></dt>
<dd><p>Input mesh file</p>
</dd>
<dt><kbd>--output</kbd></dt>
<dd><p>Output mesh file</p>
</dd>
<dt><kbd>--crs</kbd></dt>
<dd><p>crs string for the projection</p>
</dd>
</dl>
</section>
<section id="assigning-depths-from-prioritized-dems">
<h2>Assigning depths from prioritized DEMs<a class="headerlink" href="#assigning-depths-from-prioritized-dems" title="Link to this heading"></a></h2>
<p>These tools are used by the preprocessor but also work with functions that can
be used generically and consistently with SCHISM.</p>
<section id="stacked-dem-fill">
<h3>stacked_dem_fill<a class="headerlink" href="#stacked-dem-fill" title="Link to this heading"></a></h3>
<p><p>Fill node elevations in a .2dm SMS mesh or gr3 file using a prioritized list of DEMs.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">stacked_dem_fill</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">elev2depth</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">fill</span> <span class="n">FILL</span><span class="p">]</span> <span class="n">filename</span> <span class="n">demfile</span>
</pre></div>
</div>
<section id="positional-arguments">
<h4>Positional Arguments<a class="headerlink" href="#positional-arguments" title="Link to this heading"></a></h4>
<dl class="option-list">
<dt><kbd>filename</kbd></dt>
<dd><p>name of 2dm or gr3 file</p>
</dd>
<dt><kbd>demfile</kbd></dt>
<dd><p>file containing list of DEMs. These can be in any form that gdal accepts, which includes ESRI ascii format and GeoTiffs</p>
</dd>
</dl>
</section>
<section id="named-arguments">
<h4>Named Arguments<a class="headerlink" href="#named-arguments" title="Link to this heading"></a></h4>
<dl class="option-list">
<dt><kbd>--elev2depth</kbd></dt>
<dd><p>Convert elevation to depth by flipping sign. This is typical when using gr3 format, less so with 2dm.</p>
<p>Default: False</p>
</dd>
<dt><kbd>--fill</kbd></dt>
<dd><p>Fill value for areas not covered by supplied rasters.</p>
<p>Default: 2.0</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="smoother-for-complex-topography">
<h2>Smoother for complex topography<a class="headerlink" href="#smoother-for-complex-topography" title="Link to this heading"></a></h2>
<p>Often it is necessary to incorporate inudated marshy areas where elevations
are poorly sampled and contours are tortuous. The script contour_smooth.py
uses minmax curvature flow (Malladi and Sethian) to impose a minimum length scale
of change for contours, essentially unraveling the features that are most contorted.</p>
<p><p>Uses the min-max curvature flow algorithm of Malladi and Sethian to simplify DEM topograph
The script requires a subcommand like: $ contour_smooth.py smooth
The most basic subcommand is <cite>smooth</cite>. 
Given limited efficiency at the moment, the script is generally run on a small area 
and dumps intermediate points in the processing as numpy arrays so you can 
view the differences using the contour_smooth.py view subcommand.
You can  get subject-specific help on a subcommand by typing
$ model_time.py subcommand –help</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">contour_smooth</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">{</span><span class="n">smooth</span><span class="p">,</span><span class="n">view</span><span class="p">,</span><span class="n">save</span><span class="p">}</span> <span class="o">...</span>
</pre></div>
</div>
<section id="subcommands">
<h3>subcommands<a class="headerlink" href="#subcommands" title="Link to this heading"></a></h3>
<dl class="option-list">
<dt><kbd>subcommand</kbd></dt>
<dd><p>Possible choices: smooth, view, save</p>
<p>sub-commands indicating the particular action required.</p>
</dd>
</dl>
</section>
<section id="Sub-commands">
<h3>Sub-commands<a class="headerlink" href="#Sub-commands" title="Link to this heading"></a></h3>
<section id="smooth">
<h4>smooth<a class="headerlink" href="#smooth" title="Link to this heading"></a></h4>
<p>Smooth the input DEM.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contour_smooth</span> <span class="n">smooth</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">input</span> <span class="n">INPUT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">scales</span> <span class="p">[</span><span class="n">SCALES</span> <span class="o">...</span><span class="p">]]</span>
                      <span class="p">[</span><span class="o">--</span><span class="n">nstep</span> <span class="n">NSTEP</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">max_time</span> <span class="n">MAX_TIME</span><span class="p">]</span>
                      <span class="p">[</span><span class="o">--</span><span class="n">report_interval</span> <span class="n">REPORT_INTERVAL</span><span class="p">]</span>
</pre></div>
</div>
<section id="named-arguments">
<h5>Named Arguments<a class="headerlink" href="#named-arguments" title="Link to this heading"></a></h5>
<dl class="option-list">
<dt><kbd>--input</kbd></dt>
<dd><p>Input file name, file in tiff format.</p>
</dd>
<dt><kbd>--scales</kbd></dt>
<dd><p>Scales (in multiples of DEM side length) over which to smooth. The sequence [1,2,3,4] is an example, where the smoothing is gradually introduced at 10m, 20m, 30m and 40m for a 10m DEM.</p>
<p>Default: [1, 2]</p>
</dd>
<dt><kbd>--nstep</kbd></dt>
<dd><p>number of pseudo time steps to resolve integration. Default of 160 is recommended.</p>
<p>Default: 40</p>
</dd>
<dt><kbd>--max_time</kbd></dt>
<dd><p>Pseudo time representing final time step. 2.0 is the default.</p>
<p>Default: 4.0</p>
</dd>
<dt><kbd>--report_interval</kbd></dt>
<dd><p>Intermediate interval at which integration will be segmented and smoothed DEMs will be dumped. So if –max_time is 2.0 and –report_interval is 0.1 you will get 20 intermediate reports.</p>
<p>Default: 1.0</p>
</dd>
</dl>
</section>
</section>
<section id="view">
<h4>view<a class="headerlink" href="#view" title="Link to this heading"></a></h4>
<p>View two versions of the smoothed DEM based on their .npy dump.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contour_smooth</span> <span class="n">view</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">levels</span> <span class="p">[</span><span class="n">LEVELS</span> <span class="o">...</span><span class="p">]]</span> <span class="p">[</span><span class="o">--</span><span class="n">vmin</span> <span class="n">VMIN</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">vmax</span> <span class="n">VMAX</span><span class="p">]</span>
                    <span class="n">file0</span> <span class="n">file1</span>
</pre></div>
</div>
<section id="positional-arguments">
<h5>Positional Arguments<a class="headerlink" href="#positional-arguments" title="Link to this heading"></a></h5>
<dl class="option-list">
<dt><kbd>file0</kbd></dt>
<dd><p>First file in .npy format.</p>
</dd>
<dt><kbd>file1</kbd></dt>
<dd><p>Second file in .npy format.</p>
</dd>
</dl>
</section>
<section id="named-arguments_repeat1">
<h5>Named Arguments<a class="headerlink" href="#named-arguments_repeat1" title="Link to this heading"></a></h5>
<dl class="option-list">
<dt><kbd>--levels</kbd></dt>
<dd><p>Contour levels</p>
<p>Default: [-4, -3, -2, -1, 0, 1]</p>
</dd>
<dt><kbd>--vmin</kbd></dt>
<dd><p>Minimum elevation in color bar</p>
<p>Default: -6.0</p>
</dd>
<dt><kbd>--vmax</kbd></dt>
<dd><p>Maximum elevation in color bar</p>
<p>Default: 4.0</p>
</dd>
</dl>
</section>
</section>
<section id="save">
<h4>save<a class="headerlink" href="#save" title="Link to this heading"></a></h4>
<p>save dumped DEM based on .npy dump and the original DEM it came from.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contour_smooth</span> <span class="n">save</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">dumpfile</span> <span class="n">DUMPFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">original</span> <span class="n">ORIGINAL</span><span class="p">]</span>
                    <span class="p">[</span><span class="o">--</span><span class="n">outfile</span> <span class="n">OUTFILE</span><span class="p">]</span>
</pre></div>
</div>
<section id="named-arguments_repeat2">
<h5>Named Arguments<a class="headerlink" href="#named-arguments_repeat2" title="Link to this heading"></a></h5>
<dl class="option-list">
<dt><kbd>--dumpfile</kbd></dt>
<dd><p>Dump file from smoothing (npy format)</p>
</dd>
<dt><kbd>--original</kbd></dt>
<dd><p>Original DEM (GeoTiff).</p>
</dd>
<dt><kbd>--outfile</kbd></dt>
<dd><p>Output file that will be saved (GeoTiff format).</p>
</dd>
</dl>
</section>
</section>
</section>
</section>
<section id="optimizing-depths-for-volume">
<h2>Optimizing depths for volume<a class="headerlink" href="#optimizing-depths-for-volume" title="Link to this heading"></a></h2>
<p>A mesh draped over noisy bathymetry data does not necessarily represent important moments
such as volumes and vertical face areas smoothly and realistically.
To better represent these facets of the geometry,
we compare the volumetric quantities that come from SCHISM shape functions
(which are much like a TIN) to a higher order quadrature using the DEM
with bilinear interpolation. The quadrature is more accurate, and also
incorporates more sample points.</p>
<p><p>Perform grid optimization with a *.2dm SMS mesh or gr3 file. An optimized gr3 file with extension _opt.gr3 will be created if only one set of optimization parameter specified.</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">grid_opt</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">optfile</span> <span class="n">OPTFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">solver</span> <span class="n">SOLVER</span><span class="p">]</span>
                <span class="n">filename</span> <span class="n">demfile</span> <span class="n">optparm</span>
</pre></div>
</div>
<section id="positional-arguments">
<h3>Positional Arguments<a class="headerlink" href="#positional-arguments" title="Link to this heading"></a></h3>
<dl class="option-list">
<dt><kbd>filename</kbd></dt>
<dd><p>name of 2dm or gr3 file</p>
</dd>
<dt><kbd>demfile</kbd></dt>
<dd><p>file containing list of DEMs. These can be in any form that gdal accepts, which includes ESRI ascii format and GeoTiffs</p>
</dd>
<dt><kbd>optparm</kbd></dt>
<dd><p>file containing optimization parameters: damp, damp_shoreline, face_coeff, volume_coeff</p>
</dd>
</dl>
</section>
<section id="named-arguments">
<h3>Named Arguments<a class="headerlink" href="#named-arguments" title="Link to this heading"></a></h3>
<dl class="option-list">
<dt><kbd>--optfile</kbd></dt>
<dd><p>name for the gr3 file for the optimized results</p>
</dd>
<dt><kbd>--solver</kbd></dt>
<dd><p>solver used for optimization, either L-BFGS-B (default) or lsqr</p>
<p>Default: “L-BFGS-B”</p>
</dd>
</dl>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="model_time.html" class="btn btn-neutral float-left" title="Model time conversion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hotstart.html" class="btn btn-neutral float-right" title="SCHISM hotstart" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, California Department of Water Resources.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: white;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #86989B; /* existing theme was AFC1C4 and 86989B and CA7900 and white */
      
    }
  </style>


</body>
</html>