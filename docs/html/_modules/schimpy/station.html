
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>schimpy.station &#8212; schimpy 1.1.0+4.g9a8a1f7.dirty documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/logo6.png" border="0" alt="Bay-Delta SELFE Tools"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">schimpy.station</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for schimpy.station</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">schimpy.unit_conversions</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pandas.compat</span> <span class="kn">import</span> <span class="n">u</span>
    <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">open</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="nb">str</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">u</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">vtools.data.timeseries</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">station_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;elev&quot;</span><span class="p">,</span> <span class="s2">&quot;air pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;wind_x&quot;</span><span class="p">,</span> <span class="s2">&quot;wind_y&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;salt&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="staout_name"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.staout_name">[docs]</a><span class="k">def</span> <span class="nf">staout_name</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ndx</span> <span class="o">=</span> <span class="n">station_variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;staout_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ndx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input variable is not standard station variable: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">))</span></div>

<div class="viewcode-block" id="read_staout"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_staout">[docs]</a><span class="k">def</span> <span class="nf">read_staout</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">station_infile</span><span class="p">,</span><span class="n">reftime</span><span class="p">,</span><span class="n">ret_station_in</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">elim_default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a SCHISM staout_* file into a pandas DataFrame</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fpath : fname</span>
<span class="sd">        Path to input staout file or a variable name in [&quot;elev&quot;, &quot;air pressure&quot;, &quot;wind_x&quot;, &quot;wind_y&quot;,  &quot;temp&quot;, &quot;salt&quot;, &quot;u&quot;, &quot;v&quot;, &quot;w&quot;] whose</span>
<span class="sd">        1-index will be mapped to a name like staout_1 for elev</span>

<span class="sd">    station_infile : str or DataFrame</span>
<span class="sd">        Path to station.in file or DataFrame from read_station_in</span>

<span class="sd">    reftime : Timestampe</span>
<span class="sd">        Start of simulation, time basis for staout file elapse time</span>

<span class="sd">    ret_station_in : bool</span>
<span class="sd">        Return station_in DataFrame for use, which may speed reading of a second file</span>

<span class="sd">    multi : bool</span>
<span class="sd">        Should the returned data have a multi index for the column with location and sublocation. If False the two are collapsed</span>

<span class="sd">    elim_default : bool</span>
<span class="sd">        If the MultiIndex is collapsed, stations with subloc &quot;default&quot; will be collapsed. Eg. (&quot;CLC&quot;,&quot;default&quot;) becomes &quot;CLC_default&quot;</span>
<span class="sd">        </span>
<span class="sd">    time_unit : string</span>
<span class="sd">        Convertible to pandas frequency string, this is the timestamp of the file.</span>
<span class="sd">        </span>
<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame with hierarchical index (id,subloc) and columns representing the staout data (collapsed as described above</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; staout1,station_in = read_staout(&quot;staout_1&quot;,&quot;station.in&quot;,reftime=pd.Timestamp(2009,2,10),</span>
<span class="sd">                                 ret_station_in = True,multi=False,elim_default=True)</span>
<span class="sd">    &gt;&gt;&gt; staout6 = read_staout(&quot;staout_6&quot;,station_in,reftime=pd.Timestamp(2009,2,10),multi=False,elim_default=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">station_infile</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">station_in</span> <span class="o">=</span> <span class="n">read_station_in</span><span class="p">(</span><span class="n">station_infile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">station_in</span> <span class="o">=</span> <span class="n">station_infile</span>
    <span class="n">station_index</span> <span class="o">=</span> <span class="n">station_in</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">staout</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># todo: hardwire</span>
    <span class="n">staout</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">staout</span><span class="o">&lt;=-</span><span class="mf">999.</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">staout</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">station_index</span>
    <span class="n">elapsed_datetime</span><span class="p">(</span><span class="n">staout</span><span class="p">,</span><span class="n">reftime</span><span class="o">=</span><span class="n">reftime</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">)</span>
    <span class="n">staout</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">staout</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">multi</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elim_default</span><span class="p">:</span>
            <span class="n">staout</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">subloc</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">subloc</span> <span class="o">!=</span> <span class="s1">&#39;default&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">loc</span><span class="p">,</span><span class="n">subloc</span> <span class="ow">in</span> <span class="n">staout</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">staout</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">subloc</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">loc</span><span class="p">,</span><span class="n">subloc</span> <span class="ow">in</span> <span class="n">staout</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">staout</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">staout</span> <span class="o">=</span> <span class="n">staout</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>    
    <span class="k">return</span> <span class="p">(</span><span class="n">staout</span><span class="p">,</span> <span class="n">station_infile</span><span class="p">)</span> <span class="k">if</span> <span class="n">ret_station_in</span> <span class="k">else</span> <span class="n">staout</span></div>






<div class="viewcode-block" id="read_station_in"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_station_in">[docs]</a><span class="k">def</span> <span class="nf">read_station_in</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a SCHISM station.in file into a pandas DataFrame</span>

<span class="sd">    .. note::</span>
<span class="sd">        This only reads the tabular part, and assumes the BayDelta SCHISM format with columns:</span>
<span class="sd">        index x y z ! id subloc &quot;Name&quot;</span>

<span class="sd">        Note that there is no header and the delimiter is a space. Also note that the text beginning with !</span>
<span class="sd">        is extra BayDeltaSCHISM extra metadata, not required for vanilla SCHISM</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     fpath : fname</span>
<span class="sd">        Path to input station.in style file</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame with hierarchical index (id,subloc) and columns x,y,z,name</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">n_entry</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;\s+&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;excl&quot;</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;subloc&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                       <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;subloc&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                       <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;subloc&quot;</span><span class="p">],</span><span class="n">na_values</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="n">keep_default_na</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stations</span></div>



<div class="viewcode-block" id="write_station_in"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.write_station_in">[docs]</a><span class="k">def</span> <span class="nf">write_station_in</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">station_in</span><span class="p">,</span><span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write a SCHISM station.in file given a pandas DataFrame of metadata</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     fpath : fname</span>
<span class="sd">        Path to output station.in file</span>

<span class="sd">     station_in : DataFrame</span>
<span class="sd">        DataFrame that has station id, x, y, z, name and subloc labels (id is the station id, index will be autogenerated)</span>

<span class="sd">     request :  &#39;all&#39; or list(str)</span>
<span class="sd">        List of variables to put in output request from the choices &#39;elev&#39;, &#39;air pressure&#39;, &#39;wind_x&#39;, &#39;wind_y&#39;, &#39;temp&#39;, &#39;salt&#39;, &#39;u&#39;, &#39;v&#39;, &#39;w&#39;</span>
<span class="sd">        or &#39;all&#39; to include them all</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request_int</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">station_variables</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span>
    <span class="n">request_str</span> <span class="o">=</span> <span class="n">station_variables</span> <span class="k">if</span> <span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="k">else</span> <span class="n">request</span>
    <span class="n">request_int</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">request_str</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">station_variables</span><span class="p">]</span>
    <span class="n">request_explain</span> <span class="o">=</span> <span class="s1">&#39; !&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">station_variables</span><span class="p">)</span>
    <span class="n">dfmerged</span> <span class="o">=</span><span class="n">station_in</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">dfmerged</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">dfmerged</span><span class="p">[</span><span class="s2">&quot;excl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;!&quot;</span>
    <span class="n">nitem</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmerged</span><span class="p">)</span>
    <span class="c1"># First two lines are a space delimited 1 or 0 for each request then the</span>
    <span class="c1"># total number of station requests</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">request_int</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request_explain</span><span class="p">,</span><span class="n">nitem</span><span class="p">)</span>
    <span class="c1"># Then the specific requests, here written to a string buffer</span>
    <span class="n">buffer2</span> <span class="o">=</span> <span class="n">dfmerged</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;excl&quot;</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;subloc&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">index_label</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">buffer2</span><span class="p">))</span></div>
        <span class="c1">#f.write(u(buffer))</span>
        <span class="c1">#f.write(u(buffer2))</span>


<div class="viewcode-block" id="read_station_subloc"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_station_subloc">[docs]</a><span class="k">def</span> <span class="nf">read_station_subloc</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a BayDeltaSCHISM station_sublocs.csv  file into a pandas DataFrame</span>

<span class="sd">       The BayDelta SCHISM format has a header and uses &quot;,&quot; as the delimiter and has these columns:</span>
<span class="sd">       id,subloc,z</span>

<span class="sd">       The id is the station id, which is the key that joins this file to the station database. &#39;subloc&#39; is a label that describes</span>
<span class="sd">       the sublocation or subloc and z is the actual elevation of the instrument</span>

<span class="sd">       Example might be:</span>
<span class="sd">       id,subloc,z</span>
<span class="sd">       12345,top,-0.5</span>

<span class="sd">       Other columns are allowed, but this will commonly merged with the station database file so we avoid column names like &#39;name&#39; that might collide</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     fpath : fname</span>
<span class="sd">        Path to input station.in style file</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame with hierarchical index (id,subloc) and data column z</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;subloc&quot;</span><span class="p">],</span><span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">z</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;z&quot;</span><span class="p">]]</span></div>



<div class="viewcode-block" id="read_station_dbase"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_station_dbase">[docs]</a><span class="k">def</span> <span class="nf">read_station_dbase</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a BayDeltaSCHISM station data base csv  file into a pandas DataFrame</span>

<span class="sd">       The BayDelta SCHISM format is open, but expects these columns:</span>
<span class="sd">       index x y z ! id subloc &quot;Name&quot;</span>


<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     fpath : fname</span>
<span class="sd">        Path to input station.in style file</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame with hierarchical index (id,subloc) and columns x,y,z,name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">return</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="merge_station_subloc"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.merge_station_subloc">[docs]</a><span class="k">def</span> <span class="nf">merge_station_subloc</span><span class="p">(</span><span class="n">station_dbase</span><span class="p">,</span><span class="n">station_subloc</span><span class="p">,</span><span class="n">default_z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge BayDeltaSCHISM station database with subloc file, producing the union of all stations and sublocs including a default entry for stations with no subloc entry</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     station_dbase : DataFrame</span>
<span class="sd">        This should be the input that has only the station id as an index and includes other metadata like x,y,</span>

<span class="sd">     station_subloc : DataFrame</span>
<span class="sd">        This should have (id,subloc) as an index</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame that links the information.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">merged</span> <span class="o">=</span>  <span class="n">station_dbase</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">station_subloc</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
                <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">merged</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">&quot;subloc&quot;</span><span class="p">:</span><span class="s2">&quot;default&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">default_z</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">merged</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;subloc&quot;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">merged</span></div>

<div class="viewcode-block" id="read_obs_links"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_obs_links">[docs]</a><span class="k">def</span> <span class="nf">read_obs_links</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read an obs_links csv file which has comma as delimiter and (id,subloc,variable) as index &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
                     <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;subloc&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">],</span>
                     <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_levels</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                        <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="read_station_out"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_station_out">[docs]</a><span class="k">def</span> <span class="nf">read_station_out</span><span class="p">(</span><span class="n">fpath_base</span><span class="p">,</span><span class="n">stationinfo</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fpath_base</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fileno</span> <span class="o">=</span> <span class="n">station_variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Variable name </span><span class="si">{}</span><span class="s2"> not on list: </span><span class="si">{}</span><span class="s2">.format(var,station_variables&quot;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fpath_base</span><span class="p">,</span><span class="n">fileno</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">names</span> <span class="o">=</span> <span class="n">stationinfo</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">elapsed_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">reftime</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="flux_names_from_yaml"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.flux_names_from_yaml">[docs]</a><span class="k">def</span> <span class="nf">flux_names_from_yaml</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieve names of fluxlines from yaml file or content&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">full_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">inp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;linestrings&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not fine &#39;linestrings&#39; key. Was the input a string or filename? Valid file?&quot;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">linestrings</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;linestrings&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">linestrings</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">names</span></div>


<div class="viewcode-block" id="station_names_from_file"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.station_names_from_file">[docs]</a><span class="k">def</span> <span class="nf">station_names_from_file</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.yml&quot;</span><span class="p">,</span><span class="s2">&quot;.yaml&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">flux_names_from_yaml</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.prop&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Not implemented for .prop&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="read_flux_out"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.read_flux_out">[docs]</a><span class="k">def</span> <span class="nf">read_flux_out</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="n">reftime</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">station_names_from_file</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reftime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">elapsed_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">reftime</span><span class="o">=</span><span class="n">reftime</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># todo: freq when start is none?</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="example"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.example">[docs]</a><span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">read_station_in</span><span class="p">(</span><span class="s2">&quot;example_station.in&quot;</span><span class="p">))</span>
    <span class="n">stations_utm</span> <span class="o">=</span> <span class="n">read_station_dbase</span><span class="p">(</span><span class="s2">&quot;stations_utm.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">stations_utm</span><span class="p">)</span>
    <span class="n">ssubloc</span> <span class="o">=</span> <span class="n">read_station_subloc</span><span class="p">(</span><span class="s2">&quot;station_subloc.csv&quot;</span><span class="p">)</span>
    <span class="n">stations_in</span> <span class="o">=</span> <span class="n">merge_station_subloc</span><span class="p">(</span><span class="n">stations_utm</span><span class="p">,</span><span class="n">ssubloc</span><span class="p">,</span><span class="n">default_z</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1">#stations_in = pd.merge(stations_utm,ssubloc,how=&#39;inner&#39;,left_index=True,right_index=True)</span>
    <span class="c1">#print(stations_in)</span>
    <span class="n">station_request</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;salt&quot;</span><span class="p">,</span><span class="s2">&quot;elev&quot;</span><span class="p">]</span>
    <span class="n">write_station_in</span><span class="p">(</span><span class="s2">&quot;station.in&quot;</span><span class="p">,</span><span class="n">stations_in</span><span class="p">,</span><span class="n">request</span><span class="o">=</span><span class="n">station_request</span><span class="p">)</span>
    <span class="c1">#stations_in = read_station_in(&quot;station.in&quot;)</span>
    <span class="n">obs_links</span> <span class="o">=</span> <span class="n">read_obs_links</span><span class="p">(</span><span class="s2">&quot;obs_links.csv&quot;</span><span class="p">)</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">stations_in</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">obs_links</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">obs_links</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stations_in</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stations_utm</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span></div>




<span class="n">uconversions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ft&quot;</span> <span class="p">:</span> <span class="n">m_to_ft</span><span class="p">,</span> <span class="s2">&quot;ec&quot;</span> <span class="p">:</span> <span class="n">psu_ec_25c</span><span class="p">,</span> <span class="s2">&quot;cfs&quot;</span> <span class="p">:</span> <span class="n">cms_to_cfs</span><span class="p">}</span>


<div class="viewcode-block" id="station_subset"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.station_subset">[docs]</a><span class="k">def</span> <span class="nf">station_subset</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">run_start</span><span class="p">,</span><span class="n">locs</span><span class="p">,</span><span class="n">extract_freq</span><span class="p">,</span><span class="n">convert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stationfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">isflux</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">,</span><span class="n">miss</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extract a subset of stations from an staout file or flux.out file</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     fpath : str</span>
<span class="sd">        Path to the output file to be read</span>

<span class="sd">     run_start : pd.Timestamp</span>
<span class="sd">        Start time (reference time) for the simulation elapsed time</span>

<span class="sd">     locs : pd.DataFrame or str</span>
<span class="sd">        A DataFrame with rows specifying the data to subset or a string that is the path to such a file.</span>
<span class="sd">        There are a few options. Minimally this file should have either one column called &quot;station_id&quot; or</span>
<span class="sd">        one called &quot;id&quot; and another called &quot;subloc&quot;. If you use station_id, it should be an</span>
<span class="sd">        underscore-connected combination of id and subloc which should be unique, and this will be the treatment of the output.</span>
<span class="sd">        of the station. If you use &quot;subloc&quot; you can use &quot;default&quot; leave the subloc column blank. You can also use another optional</span>
<span class="sd">        column called &quot;alias&quot; and this will become the label used.</span>

<span class="sd">      extract_freq : str or pd.tseries.TimeOffset</span>
<span class="sd">        Frequency to extract ... this allows some economies if you want, say, 15min data. Use pandas freq string such as &#39;15T&#39; for 15min</span>

<span class="sd">      convert: str or function</span>
<span class="sd">         A small number of conversions are supported (&quot;ft&quot;, &quot;ec&quot; for uS/cm, &quot;cfs&quot; for flow)</span>

<span class="sd">      stationfile : str</span>
<span class="sd">         Name of station file such as station.in. In the case of flow this will be a yaml file or fluxflag.prop file produced by our preprocessing system.</span>
<span class="sd">         If you leave this None, &#39;station.in&#39; in the same directory as the output file will be assumed for staout files. For flow, a string must be supplied</span>
<span class="sd">         but will be tested first in the directory of execution and then side-by-side in that order.</span>

<span class="sd">      isflux : &#39;infer&#39; | True | False</span>
<span class="sd">         Is the request for flux.out?</span>

<span class="sd">      miss : &#39;raise&#39; | &#39;drop&#39; | &#39;nan&#39;</span>
<span class="sd">          What to do when a requested station_id does not exist. The default, raise, helps station lists from growing faulty. &#39;drop&#39; will ignore the column and &#39;nan&#39;</span>
<span class="sd">          will return nans for the column.</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame that returns the converted and subsetted data. Column names will be the ids unless &#39;alias&#39; is provided in locs, in which case those names will be</span>
<span class="sd">         swapped in.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">locs</span><span class="o">.</span><span class="n">station_id</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">station_id</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">locs</span><span class="o">=</span><span class="n">locs</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;station_id&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">isflux</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;staout&#39;</span> <span class="ow">in</span> <span class="n">fpath</span><span class="p">:</span> <span class="n">isflux</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="s1">&#39;flux&#39;</span> <span class="ow">in</span> <span class="n">fpath</span><span class="p">:</span> <span class="n">isflux</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Station output type (flux,staout) could not be inferred&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">isflux</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stationfile</span><span class="p">):</span>
            <span class="n">stationfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">stationfile</span><span class="p">)</span>
        <span class="n">staout</span> <span class="o">=</span> <span class="n">read_flux_out</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">stationfile</span><span class="p">,</span><span class="n">reftime</span><span class="o">=</span><span class="n">run_start</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stationfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stationfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;station.in&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">stationfile</span><span class="p">)</span>
        <span class="n">staout</span> <span class="o">=</span> <span class="n">read_staout</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">stationfile</span><span class="p">,</span><span class="n">reftime</span><span class="o">=</span><span class="n">run_start</span><span class="p">,</span><span class="n">ret_station_in</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">elim_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">staout</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">staout</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">extract_freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">staout</span><span class="o">=</span><span class="n">staout</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">extract_freq</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>
    <span class="n">loc_ndx</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">index</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">staout</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">miss</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Labels not in dataset:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Requested labels not in dataset&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">miss</span> <span class="o">==</span> <span class="s1">&#39;nan&#39;</span><span class="p">:</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="n">loc_ndx</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="n">miss</span> <span class="o">==</span> <span class="s1">&#39;drop&#39;</span><span class="p">:</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">staout</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;miss must be one of raise | drop | nan&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">find_nondups</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">nondups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">cset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cset</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">nondups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Column name </span><span class="si">{}</span><span class="s2"> is duplcated in outputs, accepting first instance&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="n">nondups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1">#raise ValueError(&quot;Column name {} is duplcated&quot;.format(item))</span>
        <span class="k">return</span> <span class="n">nondups</span>

    <span class="n">nondups</span> <span class="o">=</span> <span class="n">find_nondups</span><span class="p">(</span><span class="n">staout</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">staout</span> <span class="o">=</span> <span class="n">staout</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">nondups</span><span class="p">]</span>

    <span class="n">sub_df</span> <span class="o">=</span> <span class="n">staout</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;columns&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;alias&quot;</span> <span class="ow">in</span> <span class="n">locs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">locs</span><span class="o">.</span><span class="n">alias</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="n">convert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">uconversions</span><span class="p">[</span><span class="n">convert</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">convert</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">convert</span>
        <span class="n">sub_df</span> <span class="o">=</span> <span class="n">cv</span><span class="p">(</span><span class="n">sub_df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub_df</span></div>

<div class="viewcode-block" id="station_subset_multidir"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.station_subset_multidir">[docs]</a><span class="k">def</span> <span class="nf">station_subset_multidir</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span><span class="n">staoutfile</span><span class="p">,</span><span class="n">run_start</span><span class="p">,</span><span class="n">locs</span><span class="p">,</span><span class="n">extract_freq</span><span class="p">,</span><span class="n">convert</span><span class="p">,</span><span class="n">stationfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">isflux</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">,</span><span class="n">miss</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extract a subset of stations from an staout file or flux.out file across a list of directories</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>

<span class="sd">     dirs : list(str)</span>
<span class="sd">         List of directories. The output dataframe will have a column multindex (dir,station_id) where dir is the directory of the output.</span>


<span class="sd">     fpath : str</span>
<span class="sd">        Path to the output file to be read</span>

<span class="sd">     run_start : pd.Timestamp</span>
<span class="sd">        Start time (reference time) for the simulation elapsed time</span>

<span class="sd">     locs : pd.DataFrame or str</span>
<span class="sd">        A DataFrame with rows specifying the data to subset or a string that is the path to such a file.</span>
<span class="sd">        There are a few options for staout station files. Minimally this file should have either one column called &quot;station_id&quot; or</span>
<span class="sd">        one called &quot;id&quot; and another called &quot;subloc&quot;. If you use station_id, it should be an</span>
<span class="sd">        underscore-connected combination of id and subloc and this will be the index treatment of the output.</span>
<span class="sd">        Flux files only have the station_id option. If you use &quot;subloc&quot; you can use &quot;default&quot; leave the subloc column blank.</span>
<span class="sd">        You can also include another optional column called &quot;alias&quot; and this will become the label used.</span>

<span class="sd">      extract_freq : str or pd.tseries.TimeOffset</span>
<span class="sd">        Frequency to extract ... this allows some economies if you want, say, 15min data. Use pandas freq string such as &#39;15T&#39; for 15min</span>

<span class="sd">      convert: str or function</span>
<span class="sd">         A small number of conversions are supported (&quot;ft&quot;, &quot;ec&quot; for uS/cm, &quot;cfs&quot; for flow)</span>

<span class="sd">      stationfile : str</span>
<span class="sd">         Name or list of station file such as station.in. You can provide a list of the same length as dirs or a single value which will be assumed</span>
<span class="sd">         to be appropriate for all the directories. In the case of station.in, you can use None and &#39;station.in&#39; in each directory</span>
<span class="sd">         will be assumed for staout files. For flow, a string (yaml file) must be supplied but will be tested first in the directory of</span>
<span class="sd">         execution and then side-by-side in that order.</span>

<span class="sd">      isflux : &#39;infer&#39; | True | False</span>
<span class="sd">         Is the request for flux.out?</span>

<span class="sd">      miss : &#39;raise&#39; | &#39;drop&#39; | &#39;nan&#39;</span>
<span class="sd">          What to do when a requested station_id does not exist. The default, raise, helps station lists from growing faulty. &#39;drop&#39; will ignore the column and &#39;nan&#39;</span>
<span class="sd">          will return nans for the column.</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     Result : DataFrame</span>
<span class="sd">         DataFrame that returns the converted and subsetted data. Column names will be the ids unless &#39;alias&#39; is provided in locs, in which case those names will be</span>
<span class="sd">         swapped in.</span>

<span class="sd">    &quot;&quot;&quot;</span>



    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">stationfile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stationfile</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">stationfile</span> <span class="o">=</span> <span class="p">[</span><span class="n">stationfile</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stationfile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stationfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stationfile</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stationfile must be same length as dirs if it is iterable&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span><span class="n">stationfile</span><span class="p">):</span>
        <span class="n">fpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">staoutfile</span><span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station_subset</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">run_start</span><span class="p">,</span><span class="n">locs</span><span class="p">,</span><span class="n">extract_freq</span><span class="p">,</span><span class="n">convert</span><span class="p">,</span>
                                  <span class="n">stationfile</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">isflux</span><span class="o">=</span><span class="n">isflux</span><span class="p">,</span><span class="n">miss</span><span class="o">=</span><span class="n">miss</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">dirs</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span><span class="n">keys</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span><span class="s1">&#39;loc&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>







<div class="viewcode-block" id="convert_db_station_in"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.convert_db_station_in">[docs]</a><span class="k">def</span> <span class="nf">convert_db_station_in</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;station.in&quot;</span><span class="p">,</span><span class="n">stationdb</span><span class="o">=</span><span class="s2">&quot;stations_utm.csv&quot;</span><span class="p">,</span><span class="n">sublocdb</span><span class="o">=</span><span class="s2">&quot;station_subloc.csv&quot;</span><span class="p">,</span><span class="n">station_request</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span><span class="n">default</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">stations_utm</span> <span class="o">=</span> <span class="n">read_station_dbase</span><span class="p">(</span><span class="n">stationdb</span><span class="p">)</span>
    <span class="n">ssubloc</span> <span class="o">=</span> <span class="n">read_station_subloc</span><span class="p">(</span><span class="n">sublocdb</span><span class="p">)</span>
    <span class="n">stations_in</span> <span class="o">=</span> <span class="n">merge_station_subloc</span><span class="p">(</span><span class="n">stations_utm</span><span class="p">,</span><span class="n">ssubloc</span><span class="p">,</span><span class="n">default_z</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">write_station_in</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">stations_in</span><span class="p">,</span><span class="n">request</span><span class="o">=</span><span class="n">station_request</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_arg_parser"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.create_arg_parser">[docs]</a><span class="k">def</span> <span class="nf">create_arg_parser</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Create an argument parser</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Create station.in file from station database (stations_utm.csv) and station subloc listing station_subloc.csv&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--station_db&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;stations_utm.csv&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;station database, often stations_utm.csv&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--subloc_db&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;station_subloc.csv&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;subloc listings for stations (otherwise default subloc)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--request&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;requested variables or &#39;all&#39; for all of them. Possibilities are: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">station_variables</span><span class="p">)))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--default_zcor&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;-0.5&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;z coordinate used when there is no listing for station id (z coordinate, not subloc from surface)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--out&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;station.in&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;station.in formatted file&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../schimpy.html#schimpy.station.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; A main function to convert polygon files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">create_arg_parser</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">stationdb</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">station_db</span>
    <span class="n">sublocdb</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">subloc_db</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">default_zcor</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">request</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">out</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">convert_db_station_in</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">stationdb</span><span class="p">,</span><span class="n">sublocdb</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">default</span><span class="p">)</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#example()</span>
    <span class="n">main</span><span class="p">()</span>



</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">schimpy.station</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, California Department of Water Resources.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>